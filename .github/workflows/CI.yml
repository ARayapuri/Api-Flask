name: Continuous Integration

on:
 push:
  branches:
   - main
 workflow_dispatch:

jobs:
 build:
  runs-on: ubuntu-latest
  env:
   docker_username: ${{secrets.DOCKERUSERNAME}}
   docker_password: ${{secrets.DOCKERPASSWORD}}
   docker_image: karthikamn/flask-api-python-app
  steps:
   - name: Checkout
     uses: actions/checkout@v4.2.2
   - name: Docker login
     uses: docker/login-action@v2
     with:
      username: ${{env.docker_username}}
      password: ${{env.docker_password}}
   - name: Build Docker image
     run: |
      docker build -t $DOCKER_IMAGE:${{github.sha}} .
      docker tag $DOCKER_IMAGE:${{github.sha}} $DOCKER_IMAGE:latest
